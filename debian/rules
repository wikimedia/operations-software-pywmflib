#!/usr/bin/make -f

export PYBUILD_NAME = pywmflib
export PYBUILD_TEST_PYTEST = 1
export HOME = /tmp

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_test:
	SETUPTOOLS_SCM_PRETEND_VERSION="$(shell dpkg-parsechangelog -S version | cut -d '+' -f 1)" python3 setup.py develop --user
	py.test-3 --strict --cov-report=term-missing --cov=wmflib wmflib/tests/unit

override_dh_auto_clean:
	# Skip the default dh_auto_clean
	# The current clean workflow leads to a failure while
	# running pytest-runner. Example:
	# No local packages or working download links found for pytest-runner>=2.7.1

